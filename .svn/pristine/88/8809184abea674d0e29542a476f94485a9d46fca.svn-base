package minesweeper;

import java.util.Random;

public class Field {
	private final Tile[][] spielfeld;
	private final int width;
	private final int height;
	private final int minecount;

	public Field(int width, int height, int mines) {
		if (width < 1 || height < 1 || mines < 1 || mines > (width * height)) {
			throw new IllegalArgumentException("Das funktioniert so nicht!");
		}

		if (width > 50 || height > 50 || mines > 100) {
			throw new IllegalArgumentException("Nicht übertreiben!");
		}
		this.width = width;
		this.height = height;
		minecount = mines;
		spielfeld = new Tile[height][width];
		this.addRandomMines(mines);

	}

	/*
	 * AddMine bearbeitet im Endeffekt bis zu 9 Tiles. In der Mitte wird die
	 * Mine gesetzt und anschließend der Minecount der 8 Felder außenrum
	 * inkrementiert
	 * 
	 */
	public Tile addMine(int x, int y) {
		if (x < 0 || y < 0 || x >= width || y >= height) {
			throw new IllegalArgumentException();
		}
		if (spielfeld[y][x] != null && spielfeld[y][x].mined()) {
			throw new MineExistsException();

		}
		Tile tile = new Tile(x, y, true);
		spielfeld[y][x] = tile;

		for (int i = -1; i <= 1; i++) {
			for (int j = -1; j <= 1; j++) {
				if ((x + j) < 0 || (y + i) < 0 || (x + j) >= width || (y + i) >= height) {
					continue;
				} else {
					if (spielfeld[y + i][x + j] == null) {
						spielfeld[y + i][x + j] = new Tile(x + j, y + i, false);
						spielfeld[y + i][x + j].incrementMinesNearby();
					} else if (spielfeld[y + i][x + j].mined()) {
						continue;
					} else if (i == 0 && j == 0) {
						continue;
					} else {
						spielfeld[y + i][x + j].incrementMinesNearby();
					}
				}
			}
		}
		return tile;
	}

	public void addRandomMines(int minecount) {
		Random r = new Random();

		int i = 1;
		while (i <= minecount) {
			int x = r.nextInt(this.width);
			int y = r.nextInt(this.height);

			if (spielfeld[y][x] != null && spielfeld[y][x].mined()) {
				continue;
			} else {
				addMine(x, y);
				i++;
			}
		}
	}

	public int getWidth() {
		return width;
	}

	public int getHeight() {
		return height;
	}

	public Tile getTile(int x, int y) {
		if (x < 0 || y < 0 || x >= width || y >= height) {
			throw new IllegalArgumentException();
		} else {
			return this.spielfeld[y][x];
		}
	}

	public void setTile(int x, int y) {
		if (x < 0 || y < 0 || x >= width || y >= height) {
			throw new IllegalArgumentException();
		} else {
			this.spielfeld[y][x] = new Tile(x, y, false);
		}
	}

	public int getMinecount() {
		return minecount;
	}

	public Tile[][] getSpielfeld() {
		return this.spielfeld;
	}

	public static void main(String[] args) {

		Field testfeld = new Field(9, 9, 10);

		// testfeld.addRandomMines(10);
		// testfeld.addMine(5, 5);

		for (int i = 0; i < testfeld.width; i++) {
			for (int j = 0; j < testfeld.height; j++) {
				if (testfeld.spielfeld[i][j] == null) {
					System.out.print(" _ ");
				} else {
					testfeld.spielfeld[i][j].printTile();
				}

			}
			System.out.println();
		}

	}

}
